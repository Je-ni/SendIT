{"version":3,"sources":["../../server/middleware/accessToken.js"],"names":["setToken","payload","tokenTime","token","jwt","sign","env","secret","expiresIn","authorize","roles","req","res","next","accessToken","body","query","headers","data","verify","userData","includes","admin","status","json","error"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEO,IAAMA,8BAAW,SAAXA,QAAW,CAACC,OAAD,EAAa;AACnC,MAAMC,YAAY,KAAK,EAAL,GAAU,EAAV,GAAe,EAAjC,CADmC,CACE;AACrC,MAAMC,QAAQC,uBAAIC,IAAJ,CAASJ,OAAT,EAAkBK,cAAIC,MAAtB,EAA8B;AAC1CC,eAAWN;AAD+B,GAA9B,CAAd;AAGA,SAAOC,KAAP;AACD,CANM;;AAQP;AACO,IAAMM,gCAAY,SAAZA,SAAY;AAAA,MAACC,KAAD,uEAAS,EAAT;AAAA,SAAgB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC3D,QAAI;AACF,UAAMC,cAAcH,IAAII,IAAJ,CAASZ,KAAT,IAAkBQ,IAAIK,KAAJ,CAAUb,KAA5B,IAAqCQ,IAAIM,OAAJ,CAAY,gBAAZ,CAAzD;AACA,UAAMC,OAAOd,uBAAIe,MAAJ,CAAWL,WAAX,EAAwBR,cAAIC,MAA5B,CAAb;AACAI,UAAIS,QAAJ,GAAeF,IAAf;AACA,UAAI,CAACR,MAAMW,QAAN,CAAe,MAAf,CAAD,IAA2B,CAACH,KAAKI,KAArC,EAA4C,OAAOV,IAAIW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAED,QAAQ,GAAV,EAAeE,OAAO,kBAAtB,EAArB,CAAP;AAC5CZ;AACD,KAND,CAME,OAAOY,KAAP,EAAc;AACd,aAAOb,IAAIW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAED,QAAQ,GAAV,EAAeE,OAAO,kBAAtB,EAArB,CAAP;AACD;AACF,GAVwB;AAAA,CAAlB","file":"accessToken.js","sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport env from './ENV';\r\n\r\nexport const setToken = (payload) => {\r\n  const tokenTime = 60 * 60 * 24 * 30; // expires in 30 days\r\n  const token = jwt.sign(payload, env.secret, {\r\n    expiresIn: tokenTime\r\n  });\r\n  return token;\r\n};\r\n\r\n// eslint-disable-next-line consistent-return\r\nexport const authorize = (roles = []) => (req, res, next) => {\r\n  try {\r\n    const accessToken = req.body.token || req.query.token || req.headers['x-access-token'];\r\n    const data = jwt.verify(accessToken, env.secret);\r\n    req.userData = data;\r\n    if (!roles.includes('user') && !data.admin) return res.status(401).json({ status: 401, error: 'user auth failed' });\r\n    next();\r\n  } catch (error) {\r\n    return res.status(401).json({ status: 401, error: 'user auth failed' });\r\n  }\r\n};\r\n"]}